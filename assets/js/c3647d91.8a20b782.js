"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([["7009"],{7920:function(e,n,t){t.r(n),t.d(n,{default:()=>p,frontMatter:()=>a,metadata:()=>r,assets:()=>l,toc:()=>c,contentTitle:()=>s});var r=JSON.parse('{"id":"rtk-query/usage/code-generation","title":"Code Generation","description":"RTK Query > Usage > Code Generation: automated creation of API code","source":"@site/../docs/rtk-query/usage/code-generation.mdx","sourceDirName":"rtk-query/usage","slug":"/rtk-query/usage/code-generation","permalink":"/rtk-query/usage/code-generation","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1754248441000,"frontMatter":{"id":"code-generation","title":"Code Generation","sidebar_label":"Code Generation","hide_title":true,"description":"RTK Query > Usage > Code Generation: automated creation of API code"},"sidebar":"docs","previous":{"title":"Code Splitting","permalink":"/rtk-query/usage/code-splitting"},"next":{"title":"Server Side Rendering","permalink":"/rtk-query/usage/server-side-rendering"}}'),i=t("4246"),o=t("980");t("8049"),t("5181");let a={id:"code-generation",title:"Code Generation",sidebar_label:"Code Generation",hide_title:!0,description:"RTK Query > Usage > Code Generation: automated creation of API code"},s="Code Generation",l={},c=[{value:"GraphQL",id:"graphql",level:2},{value:"OpenAPI",id:"openapi",level:2},{value:"Usage",id:"usage",level:3},{value:"Generating tags",id:"generating-tags",level:4},{value:"Programmatic usage",id:"programmatic-usage",level:3},{value:"With Node.js Child process",id:"with-nodejs-child-process",level:4},{value:"Config file options",id:"config-file-options",level:3},{value:"Simple usage",id:"simple-usage",level:4},{value:"Filtering endpoints",id:"filtering-endpoints",level:4},{value:"Endpoint overrides",id:"endpoint-overrides",level:4},{value:"Generating hooks",id:"generating-hooks",level:4},{value:"Multiple output files",id:"multiple-output-files",level:4},{value:"Custom HTTP resolver options",id:"custom-http-resolver-options",level:4}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",p:"p",pre:"pre",...(0,o.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"\xa0"}),"\n",(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"code-generation",children:"Code Generation"})}),"\n",(0,i.jsx)(n.p,{children:"RTK Query's API and architecture is oriented around declaring API endpoints up front. This lends itself well to automatically generating API slice definitions from external API schema definitions, such as OpenAPI and GraphQL."}),"\n",(0,i.jsx)(n.p,{children:"We have early previews of code generation capabilities available as separate tools."}),"\n",(0,i.jsx)(n.h2,{id:"graphql",children:"GraphQL"}),"\n",(0,i.jsxs)(n.p,{children:["We provide a ",(0,i.jsx)(n.a,{href:"https://www.graphql-code-generator.com/docs/plugins/typescript-rtk-query",children:"Plugin for GraphQL Codegen"}),". You can find the documentation to that on the graphql-codegen homepage."]}),"\n",(0,i.jsxs)(n.p,{children:["For a full example on how to use it, you can see ",(0,i.jsx)(n.a,{href:"https://github.com/reduxjs/redux-toolkit/tree/master/examples/query/react/graphql-codegen",children:"this example project"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"openapi",children:"OpenAPI"}),"\n",(0,i.jsxs)(n.p,{children:["We provide a package for RTK Query code generation from OpenAPI schemas. It is published as ",(0,i.jsx)(n.code,{children:"@rtk-query/codegen-openapi"})," and you can find the source code at ",(0,i.jsx)(n.a,{href:"https://github.com/reduxjs/redux-toolkit/tree/master/packages/rtk-query-codegen-openapi",children:(0,i.jsx)(n.code,{children:"packages/rtk-query-codegen-openapi"})}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"usage",children:"Usage"}),"\n",(0,i.jsxs)(n.p,{children:["Create an empty api using ",(0,i.jsx)(n.code,{children:"createApi"})," like"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'no-transpile title="src/store/emptyApi.ts"',children:"// Or from '@reduxjs/toolkit/query' if not using the auto-generated hooks\nimport { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react'\n\n// initialize an empty api service that we'll inject endpoints into later as needed\nexport const emptySplitApi = createApi({\n  baseQuery: fetchBaseQuery({ baseUrl: '/' }),\n  endpoints: () => ({}),\n})\n"})}),"\n",(0,i.jsx)(n.p,{children:"Generate a config file (json, js or ts) with contents like"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'no-transpile title="openapi-config.ts"',children:"import type { ConfigFile } from '@rtk-query/codegen-openapi'\n\nconst config: ConfigFile = {\n  schemaFile: 'https://petstore3.swagger.io/api/v3/openapi.json',\n  apiFile: './src/store/emptyApi.ts',\n  apiImport: 'emptySplitApi',\n  outputFile: './src/store/petApi.ts',\n  exportName: 'petApi',\n  hooks: true,\n}\n\nexport default config\n"})}),"\n",(0,i.jsx)(n.p,{children:"and then call the code generator:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npx @rtk-query/codegen-openapi openapi-config.ts\n"})}),"\n",(0,i.jsx)(n.h4,{id:"generating-tags",children:"Generating tags"}),"\n",(0,i.jsxs)(n.p,{children:["If your OpenAPI specification uses ",(0,i.jsx)(n.a,{href:"https://swagger.io/docs/specification/grouping-operations-with-tags/",children:"tags"}),", you can specify the ",(0,i.jsx)(n.code,{children:"tag"})," option to the codegen.\nThat will result in all generated endpoints having ",(0,i.jsx)(n.code,{children:"providesTags"}),"/",(0,i.jsx)(n.code,{children:"invalidatesTags"})," declarations for the ",(0,i.jsx)(n.code,{children:"tags"})," of their respective operation definition."]}),"\n",(0,i.jsx)(n.p,{children:"Note that this will only result in string tags with no ids, so it might lead to scenarios where too much is invalidated and unneccessary requests are made on mutation."}),"\n",(0,i.jsxs)(n.p,{children:["In that case it is still recommended to manually specify tags by using ",(0,i.jsx)(n.a,{href:"/rtk-query/api/created-api/code-splitting",children:(0,i.jsx)(n.code,{children:"enhanceEndpoints"})})," on top of the generated api and manually declare ",(0,i.jsx)(n.code,{children:"providesTags"}),"/",(0,i.jsx)(n.code,{children:"invalidatesTags"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"programmatic-usage",children:"Programmatic usage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'no-transpile title="src/store/petApi.ts"',children:"import { generateEndpoints } from '@rtk-query/codegen-openapi'\n\nconst api = await generateEndpoints({\n  apiFile: './fixtures/emptyApi.ts',\n  schemaFile: resolve(__dirname, 'fixtures/petstore.json'),\n  filterEndpoints: ['getPetById', 'addPet'],\n  hooks: true,\n})\n"})}),"\n",(0,i.jsx)(n.h4,{id:"with-nodejs-child-process",children:"With Node.js Child process"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'no-transpile title="bin/openapi-codegen.ts"',children:"import { exec } from 'node:child_process'\n\nconst cliPath = require.resolve('@rtk-query/codegen-openapi/cli')\n\n// you can also use esbuild-runner (esr) or ts-node instead of tsx\nexec(`tsx ${cliPath} config.ts`)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"config-file-options",children:"Config file options"}),"\n",(0,i.jsx)(n.h4,{id:"simple-usage",children:"Simple usage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:"no-transpile",children:"interface SimpleUsage {\n  apiFile: string\n  schemaFile: string\n  apiImport?: string\n  exportName?: string\n  argSuffix?: string\n  operationNameSuffix?: string\n  responseSuffix?: string\n  hooks?:\n    | boolean\n    | { queries: boolean; lazyQueries: boolean; mutations: boolean }\n  tag?: boolean\n  outputFile: string\n  filterEndpoints?:\n    | string\n    | RegExp\n    | EndpointMatcherFunction\n    | Array<string | RegExp | EndpointMatcherFunction>\n  endpointOverrides?: EndpointOverrides[]\n  flattenArg?: boolean\n  useEnumType?: boolean\n  httpResolverOptions?: SwaggerParser.HTTPResolverOptions\n}\n\nexport type EndpointMatcherFunction = (\n  operationName: string,\n  operationDefinition: OperationDefinition,\n) => boolean\n"})}),"\n",(0,i.jsx)(n.h4,{id:"filtering-endpoints",children:"Filtering endpoints"}),"\n",(0,i.jsxs)(n.p,{children:["If you only want to include a few endpoints, you can use the ",(0,i.jsx)(n.code,{children:"filterEndpoints"})," config option to filter your endpoints.\nNote that endpoints are transformed to camel case. For example, ",(0,i.jsx)(n.code,{children:"login_user"})," will become ",(0,i.jsx)(n.code,{children:"loginUser"}),".\n",(0,i.jsx)(n.code,{children:"filterEndpoints"})," will be checked against this camel case version of the endpoint."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'no-transpile title="openapi-config.ts"',children:"const filteredConfig: ConfigFile = {\n  // ...\n  // should only have endpoints loginUser, placeOrder, getOrderById, deleteOrder\n  filterEndpoints: ['loginUser', /Order/],\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"endpoint-overrides",children:"Endpoint overrides"}),"\n",(0,i.jsx)(n.p,{children:"If an endpoint is generated as a mutation instead of a query or the other way round, you can override that:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'no-transpile title="openapi-config.ts"',children:"const withOverride: ConfigFile = {\n  // ...\n  endpointOverrides: [\n    {\n      pattern: 'loginUser',\n      type: 'mutation',\n    },\n  ],\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You can also filter the parameters that are included for an endpoint, as long as they aren't a path parameter. This filter is of type ",(0,i.jsx)(n.code,{children:"ParameterMatcher"}),". For example, to only include parameters that begin with \"x-\" for the 'loginUser' endpoint, see the below example."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'no-transpile title="openapi-config.ts"',children:"const withOverride: ConfigFile = {\n  // ...\n  endpointOverrides: [\n    {\n      pattern: 'loginUser',\n      parameterFilter: /^x-/,\n    },\n  ],\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["For more complex requirements, consider the other possible matchers, such as a ",(0,i.jsx)(n.code,{children:"ParameterMatcherFunction"}),". The below example filters out any parameters that are in the header of the request."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'no-transpile title="openapi-config.ts"',children:"const withOverride: ConfigFile = {\n  // ...\n  endpointOverrides: [\n    {\n      pattern: /.*/,\n      parameterFilter: (_name, parameter) => parameter.in !== 'header',\n    },\n  ],\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"generating-hooks",children:"Generating hooks"}),"\n",(0,i.jsxs)(n.p,{children:["Setting ",(0,i.jsx)(n.code,{children:"hooks: true"})," will generate ",(0,i.jsx)(n.code,{children:"useQuery"})," and ",(0,i.jsx)(n.code,{children:"useMutation"})," hook exports. If you also want ",(0,i.jsx)(n.code,{children:"useLazyQuery"})," hooks generated or more granular control, you can also pass an object in the shape of: ",(0,i.jsx)(n.code,{children:"{ queries: boolean; lazyQueries: boolean; mutations: boolean }"}),"."]}),"\n",(0,i.jsx)(n.h4,{id:"multiple-output-files",children:"Multiple output files"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'no-transpile title="openapi-config.ts"',children:"const config: ConfigFile = {\n  schemaFile: 'https://petstore3.swagger.io/api/v3/openapi.json',\n  apiFile: './src/store/emptyApi.ts',\n  outputFiles: {\n    './src/store/user.ts': {\n      filterEndpoints: [/user/i],\n    },\n    './src/store/order.ts': {\n      filterEndpoints: [/order/i],\n    },\n    './src/store/pet.ts': {\n      filterEndpoints: [/pet/i],\n    },\n  },\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"custom-http-resolver-options",children:"Custom HTTP resolver options"}),"\n",(0,i.jsxs)(n.p,{children:["If you need to customize the HTTP request issued to your server, you user the ",(0,i.jsx)(n.code,{children:"httpResolverOptions"})," option. This object is passed directly to the ",(0,i.jsx)(n.code,{children:"SwaggerParser"})," instance that fetches the OpenAPI schema."]}),"\n",(0,i.jsx)(n.p,{children:"For example, you can pass custom headers or set a custom request timeout."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'no-transpile title="openapi-config.ts"',children:"const config: ConfigFile = {\n  schemaFile: 'https://petstore3.swagger.io/api/v3/openapi.json',\n  apiFile: './src/store/emptyApi.ts',\n  outputFile: './src/store/petApi.ts',\n  httpResolverOptions: {\n    timeout: 30_000,\n    headers: {\n      Accept: 'application/json',\n      Authorization: 'Basic cmVkdXgtdG9vbGtpdDppcy1ncmVhdA==',\n    },\n  },\n}\n"})})]})}function p(e={}){let{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8049:function(e,n,t){t.d(n,{Z:()=>o});var r=t("4246");t("7378");var i=t("4870");function o(e){let{children:n,hidden:t,className:o}=e;return(0,r.jsx)("div",{role:"tabpanel",className:(0,i.Z)("tabItem_wHwb",o),hidden:t,children:n})}},5181:function(e,n,t){t.d(n,{Z:()=>v});var r=t("4246"),i=t("7378"),o=t("4870"),a=t("5403"),s=t("3620"),l=t("7090"),c=t("6180"),d=t("3418"),p=t("9073");function u(e){var n,t;return null!==(t=null===(n=i.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,i.isValidElement)(e)&&function(e){let{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw Error("Docusaurus error: Bad <Tabs> child <".concat("string"==typeof e.type?e.type:e.type.name,'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.'))}))||void 0===n?void 0:n.filter(Boolean))&&void 0!==t?t:[]}function h(e){let{value:n,tabValues:t}=e;return t.some(e=>e.value===n)}var g=t("3344");function f(e){let{className:n,block:t,selectedValue:i,selectValue:s,tabValues:l}=e,c=[],{blockElementScrollPositionUntilNextRender:d}=(0,a.o5)(),p=e=>{let n=e.currentTarget,t=l[c.indexOf(n)].value;t!==i&&(d(n),s(t))},u=e=>{var n,t;let r=null;switch(e.key){case"Enter":p(e);break;case"ArrowRight":{let t=c.indexOf(e.currentTarget)+1;r=null!==(n=c[t])&&void 0!==n?n:c[0];break}case"ArrowLeft":{let n=c.indexOf(e.currentTarget)-1;r=null!==(t=c[n])&&void 0!==t?t:c[c.length-1]}}null==r||r.focus()};return(0,r.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":t},n),children:l.map(e=>{let{value:n,label:t,attributes:a}=e;return(0,r.jsx)("li",{role:"tab",tabIndex:i===n?0:-1,"aria-selected":i===n,ref:e=>c.push(e),onKeyDown:u,onClick:p,...a,className:(0,o.Z)("tabs__item","tabItem_l0OV",null==a?void 0:a.className,{"tabs__item--active":i===n}),children:null!=t?t:n},n)})})}function m(e){let{lazy:n,children:t,selectedValue:a}=e,s=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){let e=s.find(e=>e.props.value===a);return e?(0,i.cloneElement)(e,{className:(0,o.Z)("margin-top--md",e.props.className)}):null}return(0,r.jsx)("div",{className:"margin-top--md",children:s.map((e,n)=>(0,i.cloneElement)(e,{key:n,hidden:e.props.value!==a}))})}function x(e){let n=function(e){let{defaultValue:n,queryString:t=!1,groupId:r}=e,o=function(e){let{values:n,children:t}=e;return(0,i.useMemo)(()=>{let e=null!=n?n:u(t).map(e=>{let{props:{value:n,label:t,attributes:r,default:i}}=e;return{value:n,label:t,attributes:r,default:i}});return!function(e){let n=(0,d.lx)(e,(e,n)=>e.value===n.value);if(n.length>0)throw Error('Docusaurus error: Duplicate values "'.concat(n.map(e=>e.value).join(", "),'" found in <Tabs>. Every value needs to be unique.'))}(e),e},[n,t])}(e),[a,g]=(0,i.useState)(()=>(function(e){var n;let{defaultValue:t,tabValues:r}=e;if(0===r.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!h({value:t,tabValues:r}))throw Error('Docusaurus error: The <Tabs> has a defaultValue "'.concat(t,'" but none of its children has the corresponding value. Available values are: ').concat(r.map(e=>e.value).join(", "),". If you intend to show no default tab, use defaultValue={null} instead."));return t}let i=null!==(n=r.find(e=>e.default))&&void 0!==n?n:r[0];if(!i)throw Error("Unexpected error: 0 tabValues");return i.value})({defaultValue:n,tabValues:o})),[f,m]=function(e){let{queryString:n=!1,groupId:t}=e,r=(0,s.k6)(),o=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=t?t:null}({queryString:n,groupId:t});return[(0,c._X)(o),(0,i.useCallback)(e=>{if(!o)return;let n=new URLSearchParams(r.location.search);n.set(o,e),r.replace({...r.location,search:n.toString()})},[o,r])]}({queryString:t,groupId:r}),[x,v]=function(e){let{groupId:n}=e,t=n?"docusaurus.tab.".concat(n):null,[r,o]=(0,p.Nk)(t);return[r,(0,i.useCallback)(e=>{t&&o.set(e)},[t,o])]}({groupId:r}),j=(()=>{let e=null!=f?f:x;return h({value:e,tabValues:o})?e:null})();return(0,l.Z)(()=>{j&&g(j)},[j]),{selectedValue:a,selectValue:(0,i.useCallback)(e=>{if(!h({value:e,tabValues:o}))throw Error("Can't select invalid tab value=".concat(e));g(e),m(e),v(e)},[m,v,o]),tabValues:o}}(e);return(0,r.jsxs)("div",{className:(0,o.Z)("tabs-container","tabList_J5MA"),children:[(0,r.jsx)(f,{...n,...e}),(0,r.jsx)(m,{...n,...e})]})}function v(e){let n=(0,g.Z)();return(0,r.jsx)(x,{...e,children:u(e.children)},String(n))}},980:function(e,n,t){t.d(n,{Z:function(){return s},a:function(){return a}});var r=t(7378);let i={},o=r.createContext(i);function a(e){let n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);