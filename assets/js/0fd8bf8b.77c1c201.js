"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([["7852"],{4673:function(e,n,i){i.r(n),i.d(n,{default:()=>u,frontMatter:()=>s,metadata:()=>r,assets:()=>o,toc:()=>c,contentTitle:()=>a});var r=JSON.parse('{"id":"rtk-query/internal/overview","title":"RTKQ internal","description":"Overview","source":"@site/../docs/rtk-query/internal/overview.mdx","sourceDirName":"rtk-query/internal","slug":"/rtk-query/internal/overview","permalink":"/rtk-query/internal/overview","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1747236559000,"frontMatter":{}}'),t=i("4246"),l=i("980");i("8049"),i("5181");let s={},a="RTKQ internal",o={},c=[{value:"Overview",id:"overview",level:2},{value:"createApi - The Entry Point",id:"createapi---the-entry-point",level:2},{value:"Core Module",id:"core-module",level:2},{value:"buildThunks",id:"buildthunks",level:3},{value:"buildSlice",id:"buildslice",level:3},{value:"buildMiddleware",id:"buildmiddleware",level:3},{value:"buildSelectors",id:"buildselectors",level:3},{value:"return",id:"return",level:3}];function d(e){let n={blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",ul:"ul",...(0,l.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"rtkq-internal",children:"RTKQ internal"})}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"RTK Query is a powerful data fetching and caching tool built on top of Redux Toolkit. It is designed to simplify the process of fetching, caching, and updating server state in your application. It is built on top of Redux Toolkit and uses Redux internally."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This documentation is intended to provide a high-level overview of the internal architecture of RTK-Query. It is not intended to be a comprehensive guide to the library, but rather a guide to the internal architecture and how it works."}),"\n",(0,t.jsx)(n.h2,{id:"createapi---the-entry-point",children:"createApi - The Entry Point"}),"\n",(0,t.jsxs)(n.p,{children:["When ",(0,t.jsx)(n.code,{children:"createApi()"})," is called it takes the options provided and calls internally the ",(0,t.jsx)(n.code,{children:"buildCreateApi()"})," function passing into it two modules:"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.em,{children:["Modules are RTK-Query's method of customizing how the ",(0,t.jsx)(n.code,{children:"createApi"})," method handles endpoints."]})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"coreModule()"})," - responsible for the majority of the internal handling using core redux logic i.e. slices, reducers, asyncThunks."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"reactHooksModule()"})," - a module that generates react hooks from endpoints using react-redux"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"core-module",children:"Core Module"}),"\n",(0,t.jsxs)(n.p,{children:["The core module takes the ",(0,t.jsx)(n.code,{children:"api"})," and the options passed to ",(0,t.jsx)(n.code,{children:"createApi()"}),'. In turn an internal set of "build" methods are called. Each of these build methods create a set of functions which are assigned to either ',(0,t.jsx)(n.code,{children:"api.util"})," or ",(0,t.jsx)(n.code,{children:"api.internalActions"}),' and/or passed to a future "build" step.']}),"\n",(0,t.jsx)(n.h3,{id:"buildthunks",children:"buildThunks"}),"\n",(0,t.jsxs)(n.p,{children:["RTK-Query's internal functionality operates using the same ",(0,t.jsx)(n.code,{children:"asyncThunk"}),' exposed from RTK. In the first "build" method, a number of thunks are generated for the core module to use:']}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"queryThunk"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"mutationThunk"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"patchedQueryData"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"updateQueryData"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"upsertQueryData"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"prefetch"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"buildMatchThunkActions"})}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"buildslice",children:"buildSlice"}),"\n",(0,t.jsxs)(n.p,{children:["RTK-Query uses a very familiar redux-centric architecture. Where the ",(0,t.jsx)(n.code,{children:"api"})," is a slice of your store, the ",(0,t.jsx)(n.code,{children:"api"})," has its own slices created within it. These slices are where the majority of the RTKQ magic happens."]}),"\n",(0,t.jsxs)(n.p,{children:['The slices built inside this "build" are:\n',(0,t.jsx)(n.em,{children:"Some of which have their own actions"})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"querySlice"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"mutationSlice"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"invalidationSlice"})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"subscriptionSlice"})," (used as a dummy slice to generate actions internally)"]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"internalSubscriptionsSlice"})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"configSlice"})," (internal tracking of focus state, online state, hydration etc)"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["buildSlice also exposes the core action ",(0,t.jsx)(n.code,{children:"resetApiState"})," which is subsequently added to the ",(0,t.jsx)(n.code,{children:"api.util"})]}),"\n",(0,t.jsx)(n.h3,{id:"buildmiddleware",children:"buildMiddleware"}),"\n",(0,t.jsx)(n.p,{children:"RTK-Query has a series of custom middlewares established within its store to handle additional responses in addition to the core logic established within the slices from buildSlice."}),"\n",(0,t.jsx)(n.p,{children:'Each middleware built during this step is referred to internally as a "Handler" and are as follows:'}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"buildDevCheckHandler"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"buildCacheCollectionHandler"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"buildInvalidationByTagsHandler"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"buildPollingHandler"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"buildCacheLifecycleHandler"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"buildQueryLifecycleHandler"})}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"buildselectors",children:"buildSelectors"}),"\n",(0,t.jsxs)(n.p,{children:["build selectors is a crucial step that exposes to the ",(0,t.jsx)(n.code,{children:"api"})," and utils:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"buildQuerySelector"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"buildMutationSelector"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"selectInvalidatedBy"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"selectCachedArgsForQuery"})}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"return",children:"return"}),"\n",(0,t.jsxs)(n.p,{children:["Finally each endpoint passed into the ",(0,t.jsx)(n.code,{children:"createApi()"})," is iterated over and assigned either the query or the mutation selectors, initiators and match cases."]})]})}function u(e={}){let{wrapper:n}={...(0,l.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8049:function(e,n,i){i.d(n,{Z:()=>l});var r=i("4246");i("7378");var t=i("4870");function l(e){let{children:n,hidden:i,className:l}=e;return(0,r.jsx)("div",{role:"tabpanel",className:(0,t.Z)("tabItem_wHwb",l),hidden:i,children:n})}},5181:function(e,n,i){i.d(n,{Z:()=>b});var r=i("4246"),t=i("7378"),l=i("4870"),s=i("5403"),a=i("3620"),o=i("7090"),c=i("6180"),d=i("3418"),u=i("9073");function h(e){var n,i;return null!==(i=null===(n=t.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,t.isValidElement)(e)&&function(e){let{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw Error("Docusaurus error: Bad <Tabs> child <".concat("string"==typeof e.type?e.type:e.type.name,'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.'))}))||void 0===n?void 0:n.filter(Boolean))&&void 0!==i?i:[]}function p(e){let{value:n,tabValues:i}=e;return i.some(e=>e.value===n)}var x=i("3344");function f(e){let{className:n,block:i,selectedValue:t,selectValue:a,tabValues:o}=e,c=[],{blockElementScrollPositionUntilNextRender:d}=(0,s.o5)(),u=e=>{let n=e.currentTarget,i=o[c.indexOf(n)].value;i!==t&&(d(n),a(i))},h=e=>{var n,i;let r=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{let i=c.indexOf(e.currentTarget)+1;r=null!==(n=c[i])&&void 0!==n?n:c[0];break}case"ArrowLeft":{let n=c.indexOf(e.currentTarget)-1;r=null!==(i=c[n])&&void 0!==i?i:c[c.length-1]}}null==r||r.focus()};return(0,r.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":i},n),children:o.map(e=>{let{value:n,label:i,attributes:s}=e;return(0,r.jsx)("li",{role:"tab",tabIndex:t===n?0:-1,"aria-selected":t===n,ref:e=>c.push(e),onKeyDown:h,onClick:u,...s,className:(0,l.Z)("tabs__item","tabItem_l0OV",null==s?void 0:s.className,{"tabs__item--active":t===n}),children:null!=i?i:n},n)})})}function j(e){let{lazy:n,children:i,selectedValue:s}=e,a=(Array.isArray(i)?i:[i]).filter(Boolean);if(n){let e=a.find(e=>e.props.value===s);return e?(0,t.cloneElement)(e,{className:(0,l.Z)("margin-top--md",e.props.className)}):null}return(0,r.jsx)("div",{className:"margin-top--md",children:a.map((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==s}))})}function v(e){let n=function(e){let{defaultValue:n,queryString:i=!1,groupId:r}=e,l=function(e){let{values:n,children:i}=e;return(0,t.useMemo)(()=>{let e=null!=n?n:h(i).map(e=>{let{props:{value:n,label:i,attributes:r,default:t}}=e;return{value:n,label:i,attributes:r,default:t}});return!function(e){let n=(0,d.lx)(e,(e,n)=>e.value===n.value);if(n.length>0)throw Error('Docusaurus error: Duplicate values "'.concat(n.map(e=>e.value).join(", "),'" found in <Tabs>. Every value needs to be unique.'))}(e),e},[n,i])}(e),[s,x]=(0,t.useState)(()=>(function(e){var n;let{defaultValue:i,tabValues:r}=e;if(0===r.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(i){if(!p({value:i,tabValues:r}))throw Error('Docusaurus error: The <Tabs> has a defaultValue "'.concat(i,'" but none of its children has the corresponding value. Available values are: ').concat(r.map(e=>e.value).join(", "),". If you intend to show no default tab, use defaultValue={null} instead."));return i}let t=null!==(n=r.find(e=>e.default))&&void 0!==n?n:r[0];if(!t)throw Error("Unexpected error: 0 tabValues");return t.value})({defaultValue:n,tabValues:l})),[f,j]=function(e){let{queryString:n=!1,groupId:i}=e,r=(0,a.k6)(),l=function(e){let{queryString:n=!1,groupId:i}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!i)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=i?i:null}({queryString:n,groupId:i});return[(0,c._X)(l),(0,t.useCallback)(e=>{if(!l)return;let n=new URLSearchParams(r.location.search);n.set(l,e),r.replace({...r.location,search:n.toString()})},[l,r])]}({queryString:i,groupId:r}),[v,b]=function(e){let{groupId:n}=e,i=n?"docusaurus.tab.".concat(n):null,[r,l]=(0,u.Nk)(i);return[r,(0,t.useCallback)(e=>{i&&l.set(e)},[i,l])]}({groupId:r}),m=(()=>{let e=null!=f?f:v;return p({value:e,tabValues:l})?e:null})();return(0,o.Z)(()=>{m&&x(m)},[m]),{selectedValue:s,selectValue:(0,t.useCallback)(e=>{if(!p({value:e,tabValues:l}))throw Error("Can't select invalid tab value=".concat(e));x(e),j(e),b(e)},[j,b,l]),tabValues:l}}(e);return(0,r.jsxs)("div",{className:(0,l.Z)("tabs-container","tabList_J5MA"),children:[(0,r.jsx)(f,{...n,...e}),(0,r.jsx)(j,{...n,...e})]})}function b(e){let n=(0,x.Z)();return(0,r.jsx)(v,{...e,children:h(e.children)},String(n))}},980:function(e,n,i){i.d(n,{Z:function(){return a},a:function(){return s}});var r=i(7378);let t={},l=r.createContext(t);function s(e){let n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);