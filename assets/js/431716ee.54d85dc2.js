"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([["3310"],{4785:function(e,t,n){n.r(t),n.d(t,{default:()=>h,frontMatter:()=>d,metadata:()=>a,assets:()=>l,toc:()=>s,contentTitle:()=>c});var a=JSON.parse('{"id":"api/createDynamicMiddleware","title":"createDynamicMiddleware","description":"&nbsp;","source":"@site/../docs/api/createDynamicMiddleware.mdx","sourceDirName":"api","slug":"/api/createDynamicMiddleware","permalink":"/api/createDynamicMiddleware","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1754248441000,"frontMatter":{"id":"createDynamicMiddleware","title":"createDynamicMiddleware","sidebar_label":"createDynamicMiddleware","hide_title":true},"sidebar":"docs","previous":{"title":"createListenerMiddleware","permalink":"/api/createListenerMiddleware"},"next":{"title":"getDefaultEnhancers","permalink":"/api/getDefaultEnhancers"}}'),i=n("4246"),r=n("980");n("8049"),n("5181");let d={id:"createDynamicMiddleware",title:"createDynamicMiddleware",sidebar_label:"createDynamicMiddleware",hide_title:!0},c="createDynamicMiddleware",l={},s=[{value:"Overview",id:"overview",level:2},{value:"Instance Creation",id:"instance-creation",level:2},{value:"Dynamic Middleware Instance",id:"dynamic-middleware-instance",level:2},{value:"<code>middleware</code>",id:"middleware",level:3},{value:"<code>addMiddleware</code>",id:"addmiddleware",level:3},{value:"<code>withMiddleware</code>",id:"withmiddleware",level:3},{value:"React Integration",id:"react-integration",level:2},{value:"<code>createDispatchWithMiddlewareHook</code>",id:"createdispatchwithmiddlewarehook",level:3},{value:"<code>createDispatchWithMiddlewareHookFactory</code>",id:"createdispatchwithmiddlewarehookfactory",level:3}];function o(e){let t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.p,{children:"\xa0"}),"\n",(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"createdynamicmiddleware",children:(0,i.jsx)(t.code,{children:"createDynamicMiddleware"})})}),"\n",(0,i.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(t.p,{children:'A "meta-middleware" that allows adding middleware to the dispatch chain after store initialisation.'}),"\n",(0,i.jsx)(t.h2,{id:"instance-creation",children:"Instance Creation"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-ts",metastring:"no-transpile",children:"import { createDynamicMiddleware, configureStore } from '@reduxjs/toolkit'\n\nconst dynamicMiddleware = createDynamicMiddleware()\n\nconst store = configureStore({\n  reducer: {\n    todos: todosReducer,\n  },\n  middleware: (getDefaultMiddleware) =>\n    getDefaultMiddleware().prepend(dynamicMiddleware.middleware),\n})\n"})}),"\n",(0,i.jsxs)(t.admonition,{type:"tip",children:[(0,i.jsxs)(t.p,{children:["It's possible to pass two type parameters to ",(0,i.jsx)(t.code,{children:"createDynamicMiddleware"}),", ",(0,i.jsx)(t.code,{children:"State"})," and ",(0,i.jsx)(t.code,{children:"Dispatch"}),"."]}),(0,i.jsx)(t.p,{children:"These are used by methods that receive middleware to ensure that the provided middleware are compatible with the types provided."}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-ts",metastring:"no-transpile",children:"const dynamicMiddleware = createDynamicMiddleware<State, Dispatch>()\n"})}),(0,i.jsx)(t.p,{children:"However, if these values are derived from the store (as they should be), a circular type dependency is formed."}),(0,i.jsxs)(t.p,{children:["As a result, it's better to use the ",(0,i.jsx)(t.code,{children:"withTypes"})," helper attached to ",(0,i.jsx)(t.code,{children:"addMiddleware"}),", ",(0,i.jsx)(t.code,{children:"withMiddleware"})," and ",(0,i.jsx)(t.code,{children:"createDispatchWithMiddlewareHook"}),"."]}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-ts",metastring:"no-transpile",children:"import { createDynamicMiddleware } from '@reduxjs/toolkit/react'\nimport type { RootState, AppDispatch } from './store'\n\nconst dynamicMiddleware = createDynamicMiddleware()\n\nconst {\n  middleware,\n  addMiddleware,\n  withMiddleware,\n  createDispatchWithMiddlewareHook,\n} = dynamicMiddleware\n\ninterface MiddlewareApiConfig {\n  state: RootState\n  dispatch: AppDispatch\n}\n\nexport const addAppMiddleware = addMiddleware.withTypes<MiddlewareApiConfig>()\n\nexport const withAppMiddleware = withMiddleware.withTypes<MiddlewareApiConfig>()\n\nexport const createAppDispatchWithMiddlewareHook =\n  createDispatchWithMiddlewareHook.withTypes<MiddlewareApiConfig>()\n\nexport default middleware\n"})})]}),"\n",(0,i.jsx)(t.h2,{id:"dynamic-middleware-instance",children:"Dynamic Middleware Instance"}),"\n",(0,i.jsxs)(t.p,{children:['The "dynamic middleware instance" returned from ',(0,i.jsx)(t.code,{children:"createDynamicMiddleware"})," is an object similar to the object generated by ",(0,i.jsx)(t.code,{children:"createListenerMiddleware"}),". The instance object is ",(0,i.jsx)(t.em,{children:"not"})," the actual Redux middleware itself. Rather, it contains the middleware and some instance methods used to add middleware to the chain."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-ts",metastring:"no-transpile",children:"export type DynamicMiddlewareInstance<\n  State = unknown,\n  Dispatch extends ReduxDispatch<UnknownAction> = ReduxDispatch<UnknownAction>,\n> = {\n  middleware: DynamicMiddleware<State, Dispatch>\n  addMiddleware: AddMiddleware<State, Dispatch>\n  withMiddleware: WithMiddleware<State, Dispatch>\n}\n"})}),"\n",(0,i.jsx)(t.h3,{id:"middleware",children:(0,i.jsx)(t.code,{children:"middleware"})}),"\n",(0,i.jsx)(t.p,{children:"The wrapper middleware instance, to add to the Redux store."}),"\n",(0,i.jsx)(t.p,{children:"You can place this anywhere in the middleware chain, but note that all the middleware you inject into this instance will be contained within this position."}),"\n",(0,i.jsx)(t.h3,{id:"addmiddleware",children:(0,i.jsx)(t.code,{children:"addMiddleware"})}),"\n",(0,i.jsx)(t.p,{children:"Injects a set of middleware into the instance."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-ts",metastring:"no-transpile",children:"addMiddleware(logger, listenerMiddleware.instance)\n"})}),"\n",(0,i.jsx)(t.admonition,{type:"note",children:(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Middleware are compared by function reference, and each is only added to the chain once."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Middleware are stored in an ES6 map, and are thus called in insertion order during dispatch."}),"\n"]}),"\n"]})}),"\n",(0,i.jsx)(t.h3,{id:"withmiddleware",children:(0,i.jsx)(t.code,{children:"withMiddleware"})}),"\n",(0,i.jsxs)(t.p,{children:["Accepts a set of middleware, and creates an action. When dispatched, it injects the middleware and returns a version of ",(0,i.jsx)(t.code,{children:"dispatch"})," typed to be aware of any extensions added."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-ts",metastring:"no-transpile",children:"const listenerDispatch = store.dispatch(\n  withMiddleware(listenerMiddleware.middleware),\n)\n\nconst unsubscribe = listenerDispatch(addListener({ type, effect }))\n"})}),"\n",(0,i.jsx)(t.h2,{id:"react-integration",children:"React Integration"}),"\n",(0,i.jsxs)(t.p,{children:["When imported from the React-specific entry point (",(0,i.jsx)(t.code,{children:"@reduxjs/toolkit/react"}),"), the result of calling ",(0,i.jsx)(t.code,{children:"createDynamicMiddleware"})," will have extra methods attached."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsxs)(t.em,{children:["These depend on having ",(0,i.jsx)(t.code,{children:"react-redux"})," installed."]})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-ts",metastring:"no-transpile",children:"interface ReactDynamicMiddlewareInstance<\n  State = any,\n  Dispatch extends ReduxDispatch<UnknownAction> = ReduxDispatch<UnknownAction>,\n> extends DynamicMiddlewareInstance<State, Dispatch> {\n  createDispatchWithMiddlewareHook: CreateDispatchWithMiddlewareHook<\n    State,\n    Dispatch\n  >\n  createDispatchWithMiddlewareHookFactory: (\n    context?: Context<\n      ReactReduxContextValue<State, ActionFromDispatch<Dispatch>>\n    >,\n  ) => CreateDispatchWithMiddlewareHook<State, Dispatch>\n}\n"})}),"\n",(0,i.jsx)(t.h3,{id:"createdispatchwithmiddlewarehook",children:(0,i.jsx)(t.code,{children:"createDispatchWithMiddlewareHook"})}),"\n",(0,i.jsxs)(t.p,{children:["Accepts a set of middleware, and returns a ",(0,i.jsx)(t.a,{href:"https://react-redux.js.org/api/hooks#usedispatch",children:(0,i.jsx)(t.code,{children:"useDispatch"})})," hook returning a ",(0,i.jsx)(t.code,{children:"dispatch"})," typed to include extensions from provided middleware."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-ts",metastring:"no-transpile",children:"const useListenerDispatch = createDispatchWithMiddlewareHook(\n  listenerInstance.middleware,\n)\n\nconst Component = () => {\n  const listenerDispatch = useListenerDispatch()\n  useEffect(() => {\n    const unsubscribe = listenerDispatch(addListener({ type, effect }))\n    return () => unsubscribe()\n  }, [dispatch])\n}\n"})}),"\n",(0,i.jsx)(t.admonition,{type:"caution",children:(0,i.jsxs)(t.p,{children:["Middleware is injected when ",(0,i.jsx)(t.code,{children:"createDispatchWithMiddlewareHook"})," is called, not when the ",(0,i.jsx)(t.code,{children:"useDispatch"})," hook is used."]})}),"\n",(0,i.jsx)(t.h3,{id:"createdispatchwithmiddlewarehookfactory",children:(0,i.jsx)(t.code,{children:"createDispatchWithMiddlewareHookFactory"})}),"\n",(0,i.jsxs)(t.p,{children:["Accepts a React context instance, and returns a ",(0,i.jsx)(t.code,{children:"createDispatchWithMiddlewareHook"})," built to use that context."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-ts",metastring:"no-transpile",children:"const createDispatchWithMiddlewareHook =\n  createDispatchWithMiddlewareHookFactory(context)\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Useful if you're using a ",(0,i.jsx)(t.a,{href:"https://react-redux.js.org/using-react-redux/accessing-store#providing-custom-context",children:"custom context"})," for React Redux."]})]})}function h(e={}){let{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8049:function(e,t,n){n.d(t,{Z:()=>r});var a=n("4246");n("7378");var i=n("4870");function r(e){let{children:t,hidden:n,className:r}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,i.Z)("tabItem_wHwb",r),hidden:n,children:t})}},5181:function(e,t,n){n.d(t,{Z:()=>j});var a=n("4246"),i=n("7378"),r=n("4870"),d=n("5403"),c=n("3620"),l=n("7090"),s=n("6180"),o=n("3418"),h=n("9073");function u(e){var t,n;return null!==(n=null===(t=i.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,i.isValidElement)(e)&&function(e){let{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw Error("Docusaurus error: Bad <Tabs> child <".concat("string"==typeof e.type?e.type:e.type.name,'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.'))}))||void 0===t?void 0:t.filter(Boolean))&&void 0!==n?n:[]}function p(e){let{value:t,tabValues:n}=e;return n.some(e=>e.value===t)}var m=n("3344");function w(e){let{className:t,block:n,selectedValue:i,selectValue:c,tabValues:l}=e,s=[],{blockElementScrollPositionUntilNextRender:o}=(0,d.o5)(),h=e=>{let t=e.currentTarget,n=l[s.indexOf(t)].value;n!==i&&(o(t),c(n))},u=e=>{var t,n;let a=null;switch(e.key){case"Enter":h(e);break;case"ArrowRight":{let n=s.indexOf(e.currentTarget)+1;a=null!==(t=s[n])&&void 0!==t?t:s[0];break}case"ArrowLeft":{let t=s.indexOf(e.currentTarget)-1;a=null!==(n=s[t])&&void 0!==n?n:s[s.length-1]}}null==a||a.focus()};return(0,a.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":n},t),children:l.map(e=>{let{value:t,label:n,attributes:d}=e;return(0,a.jsx)("li",{role:"tab",tabIndex:i===t?0:-1,"aria-selected":i===t,ref:e=>s.push(e),onKeyDown:u,onClick:h,...d,className:(0,r.Z)("tabs__item","tabItem_l0OV",null==d?void 0:d.className,{"tabs__item--active":i===t}),children:null!=n?n:t},t)})})}function x(e){let{lazy:t,children:n,selectedValue:d}=e,c=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){let e=c.find(e=>e.props.value===d);return e?(0,i.cloneElement)(e,{className:(0,r.Z)("margin-top--md",e.props.className)}):null}return(0,a.jsx)("div",{className:"margin-top--md",children:c.map((e,t)=>(0,i.cloneElement)(e,{key:t,hidden:e.props.value!==d}))})}function f(e){let t=function(e){let{defaultValue:t,queryString:n=!1,groupId:a}=e,r=function(e){let{values:t,children:n}=e;return(0,i.useMemo)(()=>{let e=null!=t?t:u(n).map(e=>{let{props:{value:t,label:n,attributes:a,default:i}}=e;return{value:t,label:n,attributes:a,default:i}});return!function(e){let t=(0,o.lx)(e,(e,t)=>e.value===t.value);if(t.length>0)throw Error('Docusaurus error: Duplicate values "'.concat(t.map(e=>e.value).join(", "),'" found in <Tabs>. Every value needs to be unique.'))}(e),e},[t,n])}(e),[d,m]=(0,i.useState)(()=>(function(e){var t;let{defaultValue:n,tabValues:a}=e;if(0===a.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:a}))throw Error('Docusaurus error: The <Tabs> has a defaultValue "'.concat(n,'" but none of its children has the corresponding value. Available values are: ').concat(a.map(e=>e.value).join(", "),". If you intend to show no default tab, use defaultValue={null} instead."));return n}let i=null!==(t=a.find(e=>e.default))&&void 0!==t?t:a[0];if(!i)throw Error("Unexpected error: 0 tabValues");return i.value})({defaultValue:t,tabValues:r})),[w,x]=function(e){let{queryString:t=!1,groupId:n}=e,a=(0,c.k6)(),r=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=n?n:null}({queryString:t,groupId:n});return[(0,s._X)(r),(0,i.useCallback)(e=>{if(!r)return;let t=new URLSearchParams(a.location.search);t.set(r,e),a.replace({...a.location,search:t.toString()})},[r,a])]}({queryString:n,groupId:a}),[f,j]=function(e){let{groupId:t}=e,n=t?"docusaurus.tab.".concat(t):null,[a,r]=(0,h.Nk)(n);return[a,(0,i.useCallback)(e=>{n&&r.set(e)},[n,r])]}({groupId:a}),y=(()=>{let e=null!=w?w:f;return p({value:e,tabValues:r})?e:null})();return(0,l.Z)(()=>{y&&m(y)},[y]),{selectedValue:d,selectValue:(0,i.useCallback)(e=>{if(!p({value:e,tabValues:r}))throw Error("Can't select invalid tab value=".concat(e));m(e),x(e),j(e)},[x,j,r]),tabValues:r}}(e);return(0,a.jsxs)("div",{className:(0,r.Z)("tabs-container","tabList_J5MA"),children:[(0,a.jsx)(w,{...t,...e}),(0,a.jsx)(x,{...t,...e})]})}function j(e){let t=(0,m.Z)();return(0,a.jsx)(f,{...e,children:u(e.children)},String(t))}},980:function(e,t,n){n.d(t,{Z:function(){return c},a:function(){return d}});var a=n(7378);let i={},r=a.createContext(i);function d(e){let t=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),a.createElement(r.Provider,{value:t},e.children)}}}]);