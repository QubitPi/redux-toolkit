"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([["6843"],{5445:function(e,t,r){r.r(t),r.d(t,{default:()=>p,frontMatter:()=>l,metadata:()=>n,assets:()=>c,toc:()=>d,contentTitle:()=>u});var n=JSON.parse('{"id":"rtk-query/usage/persistence-and-rehydration","title":"Persistence and Rehydration","description":"RTK Query > Usage > Persistence and Rehydration","source":"@site/../docs/rtk-query/usage/persistence-and-rehydration.mdx","sourceDirName":"rtk-query/usage","slug":"/rtk-query/usage/persistence-and-rehydration","permalink":"/rtk-query/usage/persistence-and-rehydration","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1747227812000,"frontMatter":{"id":"persistence-and-rehydration","title":"Persistence and Rehydration","sidebar_label":"Persistence and Rehydration","hide_title":true,"description":"RTK Query > Usage > Persistence and Rehydration"},"sidebar":"docs","previous":{"title":"Server Side Rendering","permalink":"/rtk-query/usage/server-side-rendering"},"next":{"title":"Usage Without React Hooks","permalink":"/rtk-query/usage/usage-without-react-hooks"}}'),a=r("4246"),i=r("980"),s=r("8049"),o=r("5181");let l={id:"persistence-and-rehydration",title:"Persistence and Rehydration",sidebar_label:"Persistence and Rehydration",hide_title:!0,description:"RTK Query > Usage > Persistence and Rehydration"},u="Persistence and Rehydration",c={},d=[{value:"Redux Persist",id:"redux-persist",level:2}];function h(e){let t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,i.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.p,{children:"\xa0"}),"\n",(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"persistence-and-rehydration",children:"Persistence and Rehydration"})}),"\n",(0,a.jsxs)(t.p,{children:["RTK Query supports rehydration via the ",(0,a.jsx)(t.a,{href:"/rtk-query/api/createApi#extractrehydrationinfo",children:(0,a.jsx)(t.code,{children:"extractRehydrationInfo"})}),"\noption on ",(0,a.jsx)(t.a,{href:"/rtk-query/api/createApi",children:(0,a.jsx)(t.code,{children:"createApi"})}),". This function is passed every dispatched action,\nand where it returns a value other than ",(0,a.jsx)(t.code,{children:"undefined"}),", that value is used to rehydrate the API state\nfor fulfilled & errored queries."]}),"\n",(0,a.jsxs)(t.p,{children:["See also ",(0,a.jsx)(t.a,{href:"/rtk-query/usage/server-side-rendering",children:"Server Side Rendering"}),"."]}),"\n",(0,a.jsx)(t.admonition,{type:"info",children:(0,a.jsxs)(t.p,{children:["Generally, persisting API slices is not recommended and instead, mechanisms like\n",(0,a.jsxs)(t.a,{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control",children:[(0,a.jsx)(t.code,{children:"Cache-Control"})," Headers"]}),"\nshould be used in browsers to define cache behavior.\nPersisting and rehydrating an api slice might always leave the user with very stale data if the user\nhas not visited the page for some time.\nNonetheless, in environments like Native Apps, where there is no browser cache to take care of this,\npersistance might still be a viable option."]})}),"\n",(0,a.jsx)(t.h2,{id:"redux-persist",children:"Redux Persist"}),"\n",(0,a.jsxs)(t.p,{children:["API state rehydration can be used in conjunction with ",(0,a.jsx)(t.a,{href:"https://github.com/rt2zz/redux-persist",children:"Redux Persist"}),"\nby leveraging the ",(0,a.jsx)(t.code,{children:"REHYDRATE"})," action type imported from ",(0,a.jsx)(t.code,{children:"redux-persist"}),". This can be used out of the\nbox with the ",(0,a.jsx)(t.code,{children:"autoMergeLevel1"})," or ",(0,a.jsx)(t.code,{children:"autoMergeLevel2"})," ",(0,a.jsx)(t.a,{href:"https://github.com/rt2zz/redux-persist#state-reconciler",children:"state reconcilers"}),"\nwhen persisting the root reducer, or with the ",(0,a.jsx)(t.code,{children:"autoMergeLevel1"})," reconciler when persisting just the api reducer."]}),"\n",(0,a.jsxs)(o.Z,{groupId:"language",defaultValue:"ts",values:[{label:"TypeScript",value:"ts"},{label:"JavaScript",value:"js"}],children:[(0,a.jsx)(s.Z,{value:"ts",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ts",metastring:'title="redux-persist rehydration example"',children:"import type { Action } from '@reduxjs/toolkit'\nimport { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react'\nimport { REHYDRATE } from 'redux-persist'\n\ntype RootState = any // normally inferred from state\n\nfunction isHydrateAction(action: Action): action is Action<typeof REHYDRATE> & {\n  key: string\n  payload: RootState\n  err: unknown\n} {\n  return action.type === REHYDRATE\n}\n\nexport const api = createApi({\n  baseQuery: fetchBaseQuery({ baseUrl: '/' }),\n  // highlight-start\n  // to prevent circular type issues, the return type needs to be annotated as any\n  extractRehydrationInfo(action, { reducerPath }): any {\n    if (isHydrateAction(action)) {\n      // when persisting the api reducer\n      if (action.key === 'key used with redux-persist') {\n        return action.payload\n      }\n\n      // When persisting the root reducer\n      return action.payload[api.reducerPath]\n    }\n  },\n  // highlight-end\n  endpoints: (build) => ({\n    // omitted\n  }),\n})\n"})})}),(0,a.jsx)(s.Z,{value:"js",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-js",metastring:'title="redux-persist rehydration example"',children:"import { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react'\nimport { REHYDRATE } from 'redux-persist'\n\nfunction isHydrateAction(action) {\n  return action.type === REHYDRATE\n}\n\nexport const api = createApi({\n  baseQuery: fetchBaseQuery({ baseUrl: '/' }),\n  // highlight-start\n  // to prevent circular type issues, the return type needs to be annotated as any\n  extractRehydrationInfo(action, { reducerPath }) {\n    if (isHydrateAction(action)) {\n      // when persisting the api reducer\n      if (action.key === 'key used with redux-persist') {\n        return action.payload\n      }\n\n      // When persisting the root reducer\n      return action.payload[api.reducerPath]\n    }\n  },\n  // highlight-end\n  endpoints: (build) => ({\n    // omitted\n  }),\n})\n"})})})]})]})}function p(e={}){let{wrapper:t}={...(0,i.a)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},8049:function(e,t,r){r.d(t,{Z:()=>i});var n=r("4246");r("7378");var a=r("4870");function i(e){let{children:t,hidden:r,className:i}=e;return(0,n.jsx)("div",{role:"tabpanel",className:(0,a.Z)("tabItem_wHwb",i),hidden:r,children:t})}},5181:function(e,t,r){r.d(t,{Z:()=>x});var n=r("4246"),a=r("7378"),i=r("4870"),s=r("5403"),o=r("3620"),l=r("7090"),u=r("6180"),c=r("3418"),d=r("9073");function h(e){var t,r;return null!==(r=null===(t=a.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,a.isValidElement)(e)&&function(e){let{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw Error("Docusaurus error: Bad <Tabs> child <".concat("string"==typeof e.type?e.type:e.type.name,'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.'))}))||void 0===t?void 0:t.filter(Boolean))&&void 0!==r?r:[]}function p(e){let{value:t,tabValues:r}=e;return r.some(e=>e.value===t)}var f=r("3344");function y(e){let{className:t,block:r,selectedValue:a,selectValue:o,tabValues:l}=e,u=[],{blockElementScrollPositionUntilNextRender:c}=(0,s.o5)(),d=e=>{let t=e.currentTarget,r=l[u.indexOf(t)].value;r!==a&&(c(t),o(r))},h=e=>{var t,r;let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{let r=u.indexOf(e.currentTarget)+1;n=null!==(t=u[r])&&void 0!==t?t:u[0];break}case"ArrowLeft":{let t=u.indexOf(e.currentTarget)-1;n=null!==(r=u[t])&&void 0!==r?r:u[u.length-1]}}null==n||n.focus()};return(0,n.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":r},t),children:l.map(e=>{let{value:t,label:r,attributes:s}=e;return(0,n.jsx)("li",{role:"tab",tabIndex:a===t?0:-1,"aria-selected":a===t,ref:e=>u.push(e),onKeyDown:h,onClick:d,...s,className:(0,i.Z)("tabs__item","tabItem_l0OV",null==s?void 0:s.className,{"tabs__item--active":a===t}),children:null!=r?r:t},t)})})}function m(e){let{lazy:t,children:r,selectedValue:s}=e,o=(Array.isArray(r)?r:[r]).filter(Boolean);if(t){let e=o.find(e=>e.props.value===s);return e?(0,a.cloneElement)(e,{className:(0,i.Z)("margin-top--md",e.props.className)}):null}return(0,n.jsx)("div",{className:"margin-top--md",children:o.map((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==s}))})}function v(e){let t=function(e){let{defaultValue:t,queryString:r=!1,groupId:n}=e,i=function(e){let{values:t,children:r}=e;return(0,a.useMemo)(()=>{let e=null!=t?t:h(r).map(e=>{let{props:{value:t,label:r,attributes:n,default:a}}=e;return{value:t,label:r,attributes:n,default:a}});return!function(e){let t=(0,c.lx)(e,(e,t)=>e.value===t.value);if(t.length>0)throw Error('Docusaurus error: Duplicate values "'.concat(t.map(e=>e.value).join(", "),'" found in <Tabs>. Every value needs to be unique.'))}(e),e},[t,r])}(e),[s,f]=(0,a.useState)(()=>(function(e){var t;let{defaultValue:r,tabValues:n}=e;if(0===n.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(r){if(!p({value:r,tabValues:n}))throw Error('Docusaurus error: The <Tabs> has a defaultValue "'.concat(r,'" but none of its children has the corresponding value. Available values are: ').concat(n.map(e=>e.value).join(", "),". If you intend to show no default tab, use defaultValue={null} instead."));return r}let a=null!==(t=n.find(e=>e.default))&&void 0!==t?t:n[0];if(!a)throw Error("Unexpected error: 0 tabValues");return a.value})({defaultValue:t,tabValues:i})),[y,m]=function(e){let{queryString:t=!1,groupId:r}=e,n=(0,o.k6)(),i=function(e){let{queryString:t=!1,groupId:r}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!r)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=r?r:null}({queryString:t,groupId:r});return[(0,u._X)(i),(0,a.useCallback)(e=>{if(!i)return;let t=new URLSearchParams(n.location.search);t.set(i,e),n.replace({...n.location,search:t.toString()})},[i,n])]}({queryString:r,groupId:n}),[v,x]=function(e){let{groupId:t}=e,r=t?"docusaurus.tab.".concat(t):null,[n,i]=(0,d.Nk)(r);return[n,(0,a.useCallback)(e=>{r&&i.set(e)},[r,i])]}({groupId:n}),g=(()=>{let e=null!=y?y:v;return p({value:e,tabValues:i})?e:null})();return(0,l.Z)(()=>{g&&f(g)},[g]),{selectedValue:s,selectValue:(0,a.useCallback)(e=>{if(!p({value:e,tabValues:i}))throw Error("Can't select invalid tab value=".concat(e));f(e),m(e),x(e)},[m,x,i]),tabValues:i}}(e);return(0,n.jsxs)("div",{className:(0,i.Z)("tabs-container","tabList_J5MA"),children:[(0,n.jsx)(y,{...t,...e}),(0,n.jsx)(m,{...t,...e})]})}function x(e){let t=(0,f.Z)();return(0,n.jsx)(v,{...e,children:h(e.children)},String(t))}},980:function(e,t,r){r.d(t,{Z:function(){return o},a:function(){return s}});var n=r(7378);let a={},i=n.createContext(a);function s(e){let t=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);