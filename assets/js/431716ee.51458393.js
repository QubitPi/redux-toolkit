"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[4383],{3411:function(e,t,a){a.d(t,{Z:function(){return d}});var n=a(7378),r=a(7140),i="tabItem_wHwb";function d(e){var t=e.children,a=e.hidden,d=e.className;return n.createElement("div",{role:"tabpanel",className:(0,r.Z)(i,d),hidden:a},t)}},2453:function(e,t,a){a.d(t,{Z:function(){return m}});var n=a(2685),r=a(7378),i=a(7140),d=a(362),o=a(56),l=a(5720),c=a(9169),s="tabList_J5MA",p="tabItem_l0OV";function u(e){var t,a,d=e.lazy,u=e.block,m=e.defaultValue,h=e.values,w=e.groupId,f=e.className,k=r.Children.map(e.children,(function(e){if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),y=null!=h?h:k.map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes}})),v=(0,o.l)(y,(function(e,t){return e.value===t.value}));if(v.length>0)throw new Error('Docusaurus error: Duplicate values "'+v.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var b=null===m?m:null!=(t=null!=m?m:null==(a=k.find((function(e){return e.props.default})))?void 0:a.props.value)?t:k[0].props.value;if(null!==b&&!y.some((function(e){return e.value===b})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+b+'" but none of its children has the corresponding value. Available values are: '+y.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var g=(0,l.U)(),M=g.tabGroupChoices,D=g.setTabGroupChoices,N=(0,r.useState)(b),x=N[0],C=N[1],O=[],j=(0,c.o5)().blockElementScrollPositionUntilNextRender;if(null!=w){var T=M[w];null!=T&&T!==x&&y.some((function(e){return e.value===T}))&&C(T)}var E=function(e){var t=e.currentTarget,a=O.indexOf(t),n=y[a].value;n!==x&&(j(t),C(n),null!=w&&D(w,String(n)))},A=function(e){var t,a=null;switch(e.key){case"ArrowRight":var n,r=O.indexOf(e.currentTarget)+1;a=null!=(n=O[r])?n:O[0];break;case"ArrowLeft":var i,d=O.indexOf(e.currentTarget)-1;a=null!=(i=O[d])?i:O[O.length-1]}null==(t=a)||t.focus()};return r.createElement("div",{className:(0,i.Z)("tabs-container",s)},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":u},f)},y.map((function(e){var t=e.value,a=e.label,d=e.attributes;return r.createElement("li",(0,n.Z)({role:"tab",tabIndex:x===t?0:-1,"aria-selected":x===t,key:t,ref:function(e){return O.push(e)},onKeyDown:A,onFocus:E,onClick:E},d,{className:(0,i.Z)("tabs__item",p,null==d?void 0:d.className,{"tabs__item--active":x===t})}),null!=a?a:t)}))),d?(0,r.cloneElement)(k.filter((function(e){return e.props.value===x}))[0],{className:"margin-top--md"}):r.createElement("div",{className:"margin-top--md"},k.map((function(e,t){return(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==x})}))))}function m(e){var t=(0,d.Z)();return r.createElement(u,(0,n.Z)({key:String(t)},e))}},9810:function(e,t,a){a.r(t),a.d(t,{assets:function(){return s},contentTitle:function(){return l},default:function(){return m},frontMatter:function(){return o},metadata:function(){return c},toc:function(){return p}});var n=a(2685),r=a(1244),i=(a(7378),a(5318)),d=(a(3411),a(2453),["components"]),o={id:"createDynamicMiddleware",title:"createDynamicMiddleware",sidebar_label:"createDynamicMiddleware",hide_title:!0},l=void 0,c={unversionedId:"api/createDynamicMiddleware",id:"api/createDynamicMiddleware",title:"createDynamicMiddleware",description:"&nbsp;",source:"@site/../docs/api/createDynamicMiddleware.mdx",sourceDirName:"api",slug:"/api/createDynamicMiddleware",permalink:"/api/createDynamicMiddleware",draft:!1,tags:[],version:"current",lastUpdatedAt:1716194519,formattedLastUpdatedAt:"May 20, 2024",frontMatter:{id:"createDynamicMiddleware",title:"createDynamicMiddleware",sidebar_label:"createDynamicMiddleware",hide_title:!0},sidebar:"docs",previous:{title:"createListenerMiddleware",permalink:"/api/createListenerMiddleware"},next:{title:"getDefaultEnhancers",permalink:"/api/getDefaultEnhancers"}},s={},p=[{value:"Overview",id:"overview",level:2},{value:"Instance Creation",id:"instance-creation",level:2},{value:"Dynamic Middleware Instance",id:"dynamic-middleware-instance",level:2},{value:"<code>middleware</code>",id:"middleware",level:3},{value:"<code>addMiddleware</code>",id:"addmiddleware",level:3},{value:"<code>withMiddleware</code>",id:"withmiddleware",level:3},{value:"React Integration",id:"react-integration",level:2},{value:"<code>createDispatchWithMiddlewareHook</code>",id:"createdispatchwithmiddlewarehook",level:3},{value:"<code>createDispatchWithMiddlewareHookFactory</code>",id:"createdispatchwithmiddlewarehookfactory",level:3}],u={toc:p};function m(e){var t=e.components,a=(0,r.Z)(e,d);return(0,i.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"createdynamicmiddleware"},(0,i.kt)("inlineCode",{parentName:"h1"},"createDynamicMiddleware")),(0,i.kt)("h2",{id:"overview"},"Overview"),(0,i.kt)("p",null,'A "meta-middleware" that allows adding middleware to the dispatch chain after store initialisation.'),(0,i.kt)("h2",{id:"instance-creation"},"Instance Creation"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:"no-transpile","no-transpile":!0},"import { createDynamicMiddleware, configureStore } from '@reduxjs/toolkit'\n\nconst dynamicMiddleware = createDynamicMiddleware()\n\nconst store = configureStore({\n  reducer: {\n    todos: todosReducer,\n  },\n  middleware: (getDefaultMiddleware) =>\n    getDefaultMiddleware().prepend(dynamicMiddleware.middleware),\n})\n")),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"It's possible to pass two type parameters to ",(0,i.kt)("inlineCode",{parentName:"p"},"createDynamicMiddleware"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"State")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Dispatch"),"."),(0,i.kt)("p",{parentName:"admonition"},"These are used by methods that receive middleware to ensure that the provided middleware are compatible with the types provided."),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:"no-transpile","no-transpile":!0},"const dynamicMiddleware = createDynamicMiddleware<State, Dispatch>()\n")),(0,i.kt)("p",{parentName:"admonition"},"However, if these values are derived from the store (as they should be), a circular type dependency is formed."),(0,i.kt)("p",{parentName:"admonition"},"As a result, it's better to use the ",(0,i.kt)("inlineCode",{parentName:"p"},"withTypes")," helper attached to ",(0,i.kt)("inlineCode",{parentName:"p"},"addMiddleware"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"withMiddleware")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"createDispatchWithMiddlewareHook"),"."),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:"no-transpile","no-transpile":!0},"import { createDynamicMiddleware } from '@reduxjs/toolkit/react'\nimport type { RootState, AppDispatch } from './store'\n\nconst dynamicMiddleware = createDynamicMiddleware()\n\nconst {\n  middleware,\n  addMiddleware,\n  withMiddleware,\n  createDispatchWithMiddlewareHook,\n} = dynamicMiddleware\n\ninterface MiddlewareApiConfig {\n  state: RootState\n  dispatch: AppDispatch\n}\n\nexport const addAppMiddleware = addMiddleware.withTypes<MiddlewareApiConfig>()\n\nexport const withAppMiddleware = withMiddleware.withTypes<MiddlewareApiConfig>()\n\nexport const createAppDispatchWithMiddlewareHook =\n  createDispatchWithMiddlewareHook.withTypes<MiddlewareApiConfig>()\n\nexport default middleware\n"))),(0,i.kt)("h2",{id:"dynamic-middleware-instance"},"Dynamic Middleware Instance"),(0,i.kt)("p",null,'The "dynamic middleware instance" returned from ',(0,i.kt)("inlineCode",{parentName:"p"},"createDynamicMiddleware")," is an object similar to the object generated by ",(0,i.kt)("inlineCode",{parentName:"p"},"createListenerMiddleware"),". The instance object is ",(0,i.kt)("em",{parentName:"p"},"not")," the actual Redux middleware itself. Rather, it contains the middleware and some instance methods used to add middleware to the chain."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:"no-transpile","no-transpile":!0},"export type DynamicMiddlewareInstance<\n  State = unknown,\n  Dispatch extends ReduxDispatch<UnknownAction> = ReduxDispatch<UnknownAction>,\n> = {\n  middleware: DynamicMiddleware<State, Dispatch>\n  addMiddleware: AddMiddleware<State, Dispatch>\n  withMiddleware: WithMiddleware<State, Dispatch>\n}\n")),(0,i.kt)("h3",{id:"middleware"},(0,i.kt)("inlineCode",{parentName:"h3"},"middleware")),(0,i.kt)("p",null,"The wrapper middleware instance, to add to the Redux store."),(0,i.kt)("p",null,"You can place this anywhere in the middleware chain, but note that all the middleware you inject into this instance will be contained within this position."),(0,i.kt)("h3",{id:"addmiddleware"},(0,i.kt)("inlineCode",{parentName:"h3"},"addMiddleware")),(0,i.kt)("p",null,"Injects a set of middleware into the instance."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:"no-transpile","no-transpile":!0},"addMiddleware(logger, listenerMiddleware.instance)\n")),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Middleware are compared by function reference, and each is only added to the chain once.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Middleware are stored in an ES6 map, and are thus called in insertion order during dispatch.")))),(0,i.kt)("h3",{id:"withmiddleware"},(0,i.kt)("inlineCode",{parentName:"h3"},"withMiddleware")),(0,i.kt)("p",null,"Accepts a set of middleware, and creates an action. When dispatched, it injects the middleware and returns a version of ",(0,i.kt)("inlineCode",{parentName:"p"},"dispatch")," typed to be aware of any extensions added."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:"no-transpile","no-transpile":!0},"const listenerDispatch = store.dispatch(\n  withMiddleware(listenerMiddleware.middleware),\n)\n\nconst unsubscribe = listenerDispatch(addListener({ type, effect }))\n")),(0,i.kt)("h2",{id:"react-integration"},"React Integration"),(0,i.kt)("p",null,"When imported from the React-specific entry point (",(0,i.kt)("inlineCode",{parentName:"p"},"@reduxjs/toolkit/react"),"), the result of calling ",(0,i.kt)("inlineCode",{parentName:"p"},"createDynamicMiddleware")," will have extra methods attached."),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"These depend on having ",(0,i.kt)("inlineCode",{parentName:"em"},"react-redux")," installed.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:"no-transpile","no-transpile":!0},"interface ReactDynamicMiddlewareInstance<\n  State = any,\n  Dispatch extends ReduxDispatch<UnknownAction> = ReduxDispatch<UnknownAction>,\n> extends DynamicMiddlewareInstance<State, Dispatch> {\n  createDispatchWithMiddlewareHook: CreateDispatchWithMiddlewareHook<\n    State,\n    Dispatch\n  >\n  createDispatchWithMiddlewareHookFactory: (\n    context?: Context<\n      ReactReduxContextValue<State, ActionFromDispatch<Dispatch>>\n    >,\n  ) => CreateDispatchWithMiddlewareHook<State, Dispatch>\n}\n")),(0,i.kt)("h3",{id:"createdispatchwithmiddlewarehook"},(0,i.kt)("inlineCode",{parentName:"h3"},"createDispatchWithMiddlewareHook")),(0,i.kt)("p",null,"Accepts a set of middleware, and returns a ",(0,i.kt)("a",{parentName:"p",href:"https://react-redux.js.org/api/hooks#usedispatch"},(0,i.kt)("inlineCode",{parentName:"a"},"useDispatch"))," hook returning a ",(0,i.kt)("inlineCode",{parentName:"p"},"dispatch")," typed to include extensions from provided middleware."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:"no-transpile","no-transpile":!0},"const useListenerDispatch = createDispatchWithMiddlewareHook(\n  listenerInstance.middleware,\n)\n\nconst Component = () => {\n  const listenerDispatch = useListenerDispatch()\n  useEffect(() => {\n    const unsubscribe = listenerDispatch(addListener({ type, effect }))\n    return () => unsubscribe()\n  }, [dispatch])\n}\n")),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"Middleware is injected when ",(0,i.kt)("inlineCode",{parentName:"p"},"createDispatchWithMiddlewareHook")," is called, not when the ",(0,i.kt)("inlineCode",{parentName:"p"},"useDispatch")," hook is used.")),(0,i.kt)("h3",{id:"createdispatchwithmiddlewarehookfactory"},(0,i.kt)("inlineCode",{parentName:"h3"},"createDispatchWithMiddlewareHookFactory")),(0,i.kt)("p",null,"Accepts a React context instance, and returns a ",(0,i.kt)("inlineCode",{parentName:"p"},"createDispatchWithMiddlewareHook")," built to use that context."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:"no-transpile","no-transpile":!0},"const createDispatchWithMiddlewareHook =\n  createDispatchWithMiddlewareHookFactory(context)\n")),(0,i.kt)("p",null,"Useful if you're using a ",(0,i.kt)("a",{parentName:"p",href:"https://react-redux.js.org/using-react-redux/accessing-store#providing-custom-context"},"custom context")," for React Redux."))}m.isMDXComponent=!0},5318:function(e,t,a){a.d(t,{Zo:function(){return s},kt:function(){return m}});var n=a(7378);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function d(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),c=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):d(d({},t),e)),a},s=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),u=c(a),m=r,h=u["".concat(l,".").concat(m)]||u[m]||p[m]||i;return a?n.createElement(h,d(d({ref:t},s),{},{components:a})):n.createElement(h,d({ref:t},s))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,d=new Array(i);d[0]=u;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:r,d[1]=o;for(var c=2;c<i;c++)d[c]=a[c];return n.createElement.apply(null,d)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"}}]);